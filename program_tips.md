# programs tips

## AisinoPay-app

1. 支付过程中金额精度问题；不同java版本数字精度问题以及解决方案

浮点数的精度问题，小数部分使用二进制近似表示十进制，不一定正好符合，double经过加减运算后在很小的精度上出现一定误差，0.0000..1的级别上，会表现出来。于是多次计算，在很大频次的场景下到一定程度会积累出一个影响现实精度的误差，比如0.01元或0.001元对应1分或者1厘。精度问题上有两个策略来解决：1种事通过每次运算后针对现实精度进行取舍，这样可以保证本次计算结果没有误差，这样累计后也没有误差；另一种策略是根据显示精度将浮点数转为整数再进行运算，运算后没有误差，比如0.6元-0.5元=0.0999...，我们可以使用60分-50分=10分即可，如果需要可以将10分再转回0.1元(转化为浮点数可能进行针对精度的取舍)。

上述是针对精度的问题，另一方面double和long都是有范围的，分别使用64bit表示浮点范围和整数范围，double相当于牺牲一定的精度来表示更大的一个范围，其浮点数和超过一定大小的整数都可能存在精度问题(比如把long.Max赋值给一个double变量，一定会损失精度)。int的上限在21亿左右(2^31)，如果使用分为单位则int上限在2100万元，显然不够用，long上限920京，十进制19位(9.2*10^18 ≈ 2^63)，即920亿亿左右，使用分为运算单位则long上限金额9京元即9亿亿元，应该还算可以了，一千次四万亿元也就0.4京元，所以针对元角分为单位甚至里为单位，long够用。虽然double的上限比long高，但是有精度损失(大整数和小数都可能存在精度损失)，为了更大的范围和更小的精度，可以使用BigDecimal，但要注意其本身就是带精度的，针对小数部分计算机本身就是二进制表示十进制数，这样的一种机制决定误差不可避免，但是应区分计算机数据误差和场景误差，比如计算机数据误差通过指定位数的取舍完全可以规避场景误差，这样每次运算后需要进行整理来保证这次运算没有场景误差，累计后也不会有问题。

2. java7-java8日期时间处理的不同；进一步高版本新特性，线程安全相关

3. DefaultHttpClient过时后的使用方式；进一步各种http工具类的对比分析，实现框架

4. http相关过程的参数设置，连接池相关；进一步网络协议/APP网络优化

5. TLS版本配置问题，服务器和客户端分别支持的版本。

6. urlencode/base64/hexToString/md5/sha256/aes/rsa/

7. 多渠道打包、屏幕适配方案、不同定制版本管理方案

8. leakcanary使用

## AisinoPay-backend


## data

名称|渠道/代理|申请时间|月交易额
-|-|-|-
海宁荻邦斯顿服饰有限公司|浙江爱信诺航天信息技术有限公司海宁分公司|2019/09/29|170w
阳朔县泰华百货商场|广西航天信息技术有限公司|2018-11-28|42w 
海宁蓝豪商务酒店有限公司|浙江爱信诺航天信息技术有限公司海宁分公司|2019-07-02|23w

当前年流水600w*30*12=18亿(50多家服务单位以及若干商户为主要流水来源)

结合20个省级单位200多家市级服务点的体系，如下场景：

1. 平均每个市级服务点拓展2个月百万级商户、10个月20w级商户的情况下，可增流水：400w*200*12=96亿
2. 平均每个市级服务点拓展10个快捷酒店->200*10*20w*12=48亿

浙江爱信诺航天信息技术有限公司海宁分公司，下半年三个商户，每月平均150w，每个商户月均50w，拓展如下场景：
1. 每个分公司(200+)海宁标准扩大一倍，即月300w流水->200*300w*12=72亿

目前终端用户3000+，除去服务单位使用几百台，商户端应有2000+台，结合场景每个分公司10台指标，对应3~10个商户即可，每台pos月流水300w/10=30w，如果是酒店，则约1000笔交易。

另外发票渠道，3w商户，终端用户3000台。
发票流水额?

8000w客户，除去对公转账、除去不交服务费的、综合按照50%转化率，剩余规模 8000w*0.5*280 = 112亿规模 ->560w；另外考虑每年新增用户，需额外加税盘申领费用(以后就没了)。
